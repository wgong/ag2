<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A programming framework for agentic AI"><meta name=author content="Chi Wang & Qingyun Wu"><link href=http://docs.ag2.ai/latest/docs/contributor-guide/how-ag2-works/hooks/ rel=canonical><link href=../generate-reply/ rel=prev><link href=../../building/creating-a-tool/ rel=next><link rel=icon href=../../../../assets/img/favicon.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.7"><title>Hooks - AG2</title><link rel=stylesheet href=../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../stylesheets/extra.aa8cf5.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Hooks"><meta property=og:description content="A programming framework for agentic AI"><meta content=http://docs.ag2.ai/latest/docs/contributor-guide/how-ag2-works/hooks/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Hooks"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-register-a-hook class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> You're viewing the <strong class=primary-text>work in progress</strong> version of the documentation. Please click <a rel=me href=http://docs.ag2.ai><strong>here</strong></a> for the latest. </div> </aside> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Hooks </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../user-guide/basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../api-reference/autogen/AfterWork/ class=md-tabs__link> API References </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../faq/FAQ/ class=md-tabs__link> FAQs </a> </li> <li class=md-tabs__item> <a href=../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../user-guide/basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api-reference/autogen/AfterWork/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Contributor Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../setup-development-environment/ class=md-nav__link> <span class=md-ellipsis> Setup Development Environment </span> </a> </li> <li class=md-nav__item> <a href=../../documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../file-bug-report/ class=md-nav__link> <span class=md-ellipsis> File Bug Report </span> </a> </li> <li class=md-nav__item> <a href=../../maintainer/ class=md-nav__link> <span class=md-ellipsis> Maintainer </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6 checked> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> How AG2 Works </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=true> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> How AG2 Works </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../initiate-chat/ class=md-nav__link> <span class=md-ellipsis> Initiate Chat </span> </a> </li> <li class=md-nav__item> <a href=../generate-reply/ class=md-nav__link> <span class=md-ellipsis> Generate Reply </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Hooks </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Hooks </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#how-to-register-a-hook class=md-nav__link> <span class=md-ellipsis> How to register a hook </span> </a> </li> <li class=md-nav__item> <a href=#1-process_message_before_send class=md-nav__link> <span class=md-ellipsis> 1. "process_message_before_send" </span> </a> </li> <li class=md-nav__item> <a href=#2-update_agent_state class=md-nav__link> <span class=md-ellipsis> 2. "update_agent_state" </span> </a> </li> <li class=md-nav__item> <a href=#3-process_last_received_message class=md-nav__link> <span class=md-ellipsis> 3. "process_last_received_message" </span> </a> </li> <li class=md-nav__item> <a href=#4-process_all_messages_before_reply class=md-nav__link> <span class=md-ellipsis> 4. "process_all_messages_before_reply" </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../building/creating-a-tool/ class=md-nav__link> <span class=md-ellipsis> Building Agents & Tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../pre-commit/ class=md-nav__link> <span class=md-ellipsis> Pre Commit </span> </a> </li> <li class=md-nav__item> <a href=../../tests/ class=md-nav__link> <span class=md-ellipsis> Tests </span> </a> </li> <li class=md-nav__item> <a href=../../Research/ class=md-nav__link> <span class=md-ellipsis> Research </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../faq/FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#how-to-register-a-hook class=md-nav__link> <span class=md-ellipsis> How to register a hook </span> </a> </li> <li class=md-nav__item> <a href=#1-process_message_before_send class=md-nav__link> <span class=md-ellipsis> 1. "process_message_before_send" </span> </a> </li> <li class=md-nav__item> <a href=#2-update_agent_state class=md-nav__link> <span class=md-ellipsis> 2. "update_agent_state" </span> </a> </li> <li class=md-nav__item> <a href=#3-process_last_received_message class=md-nav__link> <span class=md-ellipsis> 3. "process_last_received_message" </span> </a> </li> <li class=md-nav__item> <a href=#4-process_all_messages_before_reply class=md-nav__link> <span class=md-ellipsis> 4. "process_all_messages_before_reply" </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/website/mkdocs/docs/docs/contributor-guide/how-ag2-works/hooks.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1>Hooks</h1> <p>API Reference: <a href=../../api-reference/autogen/ConversableAgent#register-hook>ConversableAgent.register_hook</a></p> <p>Hooks are a means to update/review agent state before replying, and messages before sending and replying.</p> <p>You can define functions and associate them with these hooks and they will execute at certain points in the workflow, see the <a href=../../../initiate-chat>initiate_chat</a> page to see where these occur (blue circles).</p> <h3 id=how-to-register-a-hook>How to register a hook<a class=headerlink href=#how-to-register-a-hook title="Permanent link">#</a></h3> <p>Use the <a href=../../api-reference/autogen/ConversableAgent#register-hook>ConversableAgent.register_hook</a> method to register a function for a hook using the hook's string name.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>my_agent</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=s2>&quot;THE_HOOK_NAME&quot;</span><span class=p>,</span> <span class=n>my_function</span><span class=p>)</span>
</code></pre></div> <p>There are <strong>four hooks</strong> available on a ConversableAgent, let's look at them and how you use them.</p> <h3 id=1-process_message_before_send>1. "process_message_before_send"<a class=headerlink href=#1-process_message_before_send title="Permanent link">#</a></h3> <p>This hook is the only hook not in ConversableAgent's <a href=../../../generate-reply>generate_reply</a> method and is designed to intercept a message before it is sent to another agent.</p> <p>You can change the message with the hook and the change will be permanent. This is because this hook is called before a message is displayed or added to the message list.</p> <p>Signature: <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>def</span><span class=w> </span><span class=nf>your_function_name</span><span class=p>(</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=n>sender</span><span class=p>:</span> <span class=n>ConversableAgent</span><span class=p>,</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=n>message</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=n>recipient</span><span class=p>:</span> <span class=n>Agent</span><span class=p>,</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=n>silent</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=nb>str</span><span class=p>]:</span>
</code></pre></div></p> <p>Let's look at how we could prepend a message with who is sending the message (sender) and to whom it's going (recipient).</p> <p>In this example, our <code>Mike</code> agent will have this hook registered, so all their messages will have this text added.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>Agent</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Union</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>llm_config</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span> <span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>}</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>agent_mike</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mike&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>agent_bob</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=c1># Our function associated with the hook</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=k>def</span><span class=w> </span><span class=nf>update_message_before_send</span><span class=p>(</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=n>sender</span><span class=p>:</span> <span class=n>ConversableAgent</span><span class=p>,</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=n>message</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>    <span class=n>recipient</span><span class=p>:</span> <span class=n>Agent</span><span class=p>,</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=n>silent</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=nb>str</span><span class=p>]:</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>        <span class=n>msg_text</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>        <span class=n>msg_text</span> <span class=o>=</span> <span class=n>message</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>    <span class=c1># Here we prepend the message with &quot;&lt;Mike said to Bob&gt;&quot;</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>    <span class=n>msg_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&lt;</span><span class=si>{</span><span class=n>sender</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> said to </span><span class=si>{</span><span class=n>recipient</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&gt; &quot;</span> <span class=o>+</span> <span class=n>msg_text</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>        <span class=n>message</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>msg_text</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>        <span class=n>message</span> <span class=o>=</span> <span class=n>msg_text</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>    <span class=c1># Return the updated message, this will be a permanent change to the message</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>    <span class=k>return</span> <span class=n>message</span>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=c1># Register the hook with the Mike agent</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=n>agent_mike</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=s2>&quot;process_message_before_send&quot;</span><span class=p>,</span> <span class=n>update_message_before_send</span><span class=p>)</span>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=c1># Run the chat</span>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>agent_mike</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>    <span class=n>recipient</span><span class=o>=</span><span class=n>agent_bob</span><span class=p>,</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Hello Bob, tell me a joke!&quot;</span><span class=p>,</span>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=p>)</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=nb>print</span><span class=p>(</span><span class=n>chat_result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>)</span>
</code></pre></div> <p>Here's the output, you can see Mike's messages (including the initial message) now have our text prepended and the chat history has the permanently changed messages:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=go>Mike (to Bob):</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=go>&lt;Mike said to Bob&gt; Hello Bob, tell me a joke!</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=go>Bob (to Mike):</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=go>Sure, here’s a joke for you:</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=go>Why did the scarecrow win an award?</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=go>Because he was outstanding in his field!</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=go>Mike (to Bob):</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=go>&lt;Mike said to Bob&gt; That&#39;s a good one, Bob! Here&#39;s one for you:</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=go>What do you call fake spaghetti?</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=go>An impasta!</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=go>Bob (to Mike):</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=go>:Bob</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=go>Haha, that&#39;s a great one, Mike! How about this:</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=go>Why don’t skeletons fight each other?</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=go>They don’t have the guts!</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a><span class=go>Chat History:</span>
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a><span class=go>[</span>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a><span class=go>  {</span>
<a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a><span class=go>    &quot;content&quot;: &quot;&lt;Mike said to Bob&gt; Hello Bob, tell me a joke!&quot;,</span>
<a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a><span class=go>    &quot;role&quot;: &quot;assistant&quot;,</span>
<a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a><span class=go>    &quot;name&quot;: &quot;Mike&quot;</span>
<a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a><span class=go>  },</span>
<a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a><span class=go>  {</span>
<a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a><span class=go>    &quot;content&quot;: &quot;Sure, here\u2019s a joke for you:\n\nWhy did the scarecrow win an award?\n\nBecause he was outstanding in his field!&quot;,</span>
<a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a><span class=go>  },</span>
<a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a><span class=go>  {</span>
<a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=go>    &quot;content&quot;: &quot;&lt;Mike said to Bob&gt; That&#39;s a good one, Bob! Here&#39;s one for you:\n\nWhat do you call fake spaghetti?\n\nAn impasta!&quot;,</span>
<a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a><span class=go>    &quot;role&quot;: &quot;assistant&quot;,</span>
<a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a><span class=go>    &quot;name&quot;: &quot;Mike&quot;</span>
<a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a><span class=go>  },</span>
<a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a><span class=go>  {</span>
<a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a><span class=go>    &quot;content&quot;: &quot;:Bob  \nHaha, that&#39;s a great one, Mike! How about this:\n\nWhy don\u2019t skeletons fight each other?\n\nThey don\u2019t have the guts!&quot;,</span>
<a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a><span class=go>  }</span>
<a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a><span class=go>]</span>
</code></pre></div> <p>This is a good hook if you need to edit the message before it is added to the messages list, such as for redacting text.</p> <h3 id=2-update_agent_state>2. "update_agent_state"<a class=headerlink href=#2-update_agent_state title="Permanent link">#</a></h3> <p>The first of three hooks that run in the <a href=../../api-reference/autogen/ConversableAgent#generate-reply>ConversableAgent.generate_reply</a> method before the reply functions are evaluated.</p> <p>This hook is designed to be used to update an agent's state, typically their system message, before replying.</p> <p>As the system message is a key message for an LLM to consider, it's useful to be able to make sure that pertinent information is there.</p> <p>A couple of examples of where it is used: - DocAgent to update the internal summary agent's system message with the context from the ingestions and queries. - Swarms to hide/show conditional hand-offs.</p> <p>Signature: <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>def</span><span class=w> </span><span class=nf>my_update_function</span><span class=p>(</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>agent</span><span class=p>:</span> <span class=n>ConversableAgent</span><span class=p>,</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>messages</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</code></pre></div></p> <p>In the following example we will update an agent's system message to have the current date in it.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=n>llm_config</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span> <span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>}</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=n>calendar_prompt</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&quot;You are a calendar agent who answers questions on the date and day.</span><span class=se>\n</span><span class=s2>&quot;</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>                   <span class=s2>&quot;The current date is: [CURRENT_DATE]</span><span class=se>\n</span><span class=s2>&quot;</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>                   <span class=s2>&quot;The current day is: [CURRENT_DAY]&quot;</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=p>)</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=c1># Our calendar agent, we won&#39;t set a system_message here as we will set it with the hook</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=n>agent_calendar</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Calendar_Agent&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=n>agent_bob</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=c1># Our function to update the agent&#39;s system message, this will be attached to the hook</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=k>def</span><span class=w> </span><span class=nf>update_my_agent_state</span><span class=p>(</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=n>agent</span><span class=p>:</span> <span class=n>ConversableAgent</span><span class=p>,</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=n>messages</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>    <span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>    <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>    <span class=c1># Format the date as string (e.g., &quot;2025-02-25&quot;)</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>    <span class=c1># Get day of week as a string (e.g., &quot;Tuesday&quot;)</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>    <span class=n>day_of_week</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%A&quot;</span><span class=p>)</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>    <span class=c1># Update the agent&#39;s system message using the prompt template and the current date and day</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>    <span class=n>agent</span><span class=o>.</span><span class=n>update_system_message</span><span class=p>(</span><span class=n>calendar_prompt</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;[CURRENT_DATE]&quot;</span><span class=p>,</span> <span class=n>current_date</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;[CURRENT_DAY]&quot;</span><span class=p>,</span> <span class=n>day_of_week</span><span class=p>))</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=c1># Register the hook with the Calendar agent</span>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=n>agent_calendar</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=s2>&quot;update_agent_state&quot;</span><span class=p>,</span> <span class=n>update_my_agent_state</span><span class=p>)</span>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>agent_bob</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>    <span class=n>recipient</span><span class=o>=</span><span class=n>agent_calendar</span><span class=p>,</span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;What&#39;s the date today and what&#39;s the day?&quot;</span><span class=p>,</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>1</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=p>)</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Calendar_Agent&#39;s system message is:</span><span class=se>\n</span><span class=si>{</span><span class=n>agent_calendar</span><span class=o>.</span><span class=n>system_message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>We can see from the output that <code>Calendar_Agent</code> is able to provide the current date and time. Furthermore, their system message is updated.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=go>Bob (to Calendar_Agent):</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=go>What&#39;s the date today and what&#39;s the day?</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=go>Calendar_Agent (to Bob):</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=go>Today&#39;s date is February 24, 2025, and it&#39;s a Monday.</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=go>Calendar_Agent&#39;s system message is:</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=go>You are a calendar agent who answers questions on the date and day.</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=go>The current date is: 2025-02-24</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=go>The current day is: Monday</span>
</code></pre></div> <h3 id=3-process_last_received_message>3. "process_last_received_message"<a class=headerlink href=#3-process_last_received_message title="Permanent link">#</a></h3> <p>This is the second of the three hooks that run in the <a href=../../api-reference/autogen/ConversableAgent#generate-reply>ConversableAgent.generate_reply</a> method before the reply functions are evaluated.</p> <p>This hook is used to process the last message in the messages list (as opposed to all messages, handled by the next hook).</p> <p>If the last message is a function call or is "exit" then it will not execute the associated function.</p> <p>Changing the message will result in permanent changes to the chat messages of the agent with the hook, but not other agents. So, changes to the messages will be present in future <a href=../../api-reference/autogen/ConversableAgent#generate-reply>generate_reply</a> calls for the agent with the hook, but not other agent's calls to <a href=../../api-reference/autogen/ConversableAgent#generate-reply>generate_reply</a>.</p> <p>A couple of examples of where it is used: - The <a href=../../api-reference/autogen/agentchat/contrib/capabilities/teachability/Teachability>Teachability capability</a> appends any relevant memos to the last message. - The <a href=../../api-reference/autogen/agentchat/contrib/capabilities/vision_capability/VisionCapability>Vision capability</a> will update the last message if it contains an image with a caption for the image using an LLM call.</p> <p>Signature: <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>def</span><span class=w> </span><span class=nf>my_processing_function</span><span class=p>(</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>    <span class=n>content</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</code></pre></div></p> <p>Here's an example that changes any instances of the word "blue" to "red" in the last message.</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Union</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=n>llm_config</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span> <span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>}</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=n>agent_scientist</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;scientist&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=n>agent_bob</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=c1># Our function for the hook, to replace &quot;blue&quot; with &quot;red&quot; in the last received message</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>def</span><span class=w> </span><span class=nf>replace_blue_with_red</span><span class=p>(</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>    <span class=n>message</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>        <span class=n>msg_text</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>)</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>        <span class=n>msg_text</span> <span class=o>=</span> <span class=n>message</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>    <span class=c1># Replace &quot;blue&quot; with &quot;red&quot; in the message</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>    <span class=n>msg_text</span> <span class=o>=</span> <span class=n>msg_text</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;blue&quot;</span><span class=p>,</span> <span class=s2>&quot;red&quot;</span><span class=p>)</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>    <span class=k>return</span> <span class=n>msg_text</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=c1># Register the hook with the Scientist agent</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=n>agent_scientist</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=s2>&quot;process_last_received_message&quot;</span><span class=p>,</span> <span class=n>replace_blue_with_red</span><span class=p>)</span>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>agent_bob</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>    <span class=n>recipient</span><span class=o>=</span><span class=n>agent_scientist</span><span class=p>,</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;In one sentence, why is the sky blue?&quot;</span><span class=p>,</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>1</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=p>)</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Chat Result first message:</span><span class=se>\n</span><span class=si>{</span><span class=n>chat_result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Scientist agent&#39;s first chat message with Bob:</span><span class=se>\n</span><span class=si>{</span><span class=n>agent_scientist</span><span class=o>.</span><span class=n>chat_messages</span><span class=p>[</span><span class=n>agent_bob</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> We can see from the output that although the question asks why the sky is blue, it is updated and changed to red before the LLM responds.</p> <p>We can see the main chat messages are unchanged but the Scientist's chat history with Bob shows that the question was changed to red.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=go>Bob (to scientist):</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=go>In one sentence, why is the sky blue?</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=go>scientist (to Bob):</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=go>The sky appears red during sunrise or sunset due to the scattering of sunlight by the atmosphere, which causes shorter blue wavelengths to dissipate and allows longer red wavelengths to dominate.</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=go>Chat Result first message:</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=go>{&#39;content&#39;: &#39;In one sentence, why is the sky blue?&#39;, &#39;role&#39;: &#39;assistant&#39;, &#39;name&#39;: &#39;Bob&#39;}</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=go>Scientist agent&#39;s first chat message with Bob:</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=go>{&#39;content&#39;: &#39;In one sentence, why is the sky red?&#39;, &#39;role&#39;: &#39;user&#39;, &#39;name&#39;: &#39;Bob&#39;}</span>
</code></pre></div> <h3 id=4-process_all_messages_before_reply>4. "process_all_messages_before_reply"<a class=headerlink href=#4-process_all_messages_before_reply title="Permanent link">#</a></h3> <p>The final hook that runs in the <a href=../../api-reference/autogen/ConversableAgent#generate-reply>ConversableAgent.generate_reply</a> method before the reply functions are evaluated.</p> <p>This hook is used to work on all messages before replying.</p> <p>The changes to these messages will be used for the replying but will not persist beyond the <a href=../../api-reference/autogen/ConversableAgent#generate-reply>generate_reply</a> call.</p> <p>An example of the use of this hook is the <a href=../../api-reference/autogen/agentchat/contrib/capabilities/transform_messages/TransformMessages>TransformMessages</a> capability where it carries out all transforms (such as limiting the number messages, filtering sensitive information, truncating individual messages) on messages before an agent replies.</p> <p>Signature: <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>def</span><span class=w> </span><span class=nf>your_function_name</span><span class=p>(</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    <span class=n>messages</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</code></pre></div></p> <p>Here's an example that adds the agent's name to the start of each message.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=n>llm_config</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span> <span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>}</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=n>agent_mike</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mike&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span> <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are a comedian.&quot;</span><span class=p>)</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=n>agent_bob</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span> <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are a comedian.&quot;</span><span class=p>)</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=c1># Our function for the hook, to prepend the agent&#39;s name on each message</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=k>def</span><span class=w> </span><span class=nf>prepend_name</span><span class=p>(</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>    <span class=n>messages</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>messages</span><span class=p>:</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>        <span class=k>if</span> <span class=s2>&quot;name&quot;</span> <span class=ow>in</span> <span class=n>message</span><span class=p>:</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>            <span class=n>message</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> said: </span><span class=si>{</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>    <span class=c1># Print out the updated messages so we can see what has changed before the agent replies</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>[Updated messages]:&quot;</span><span class=p>)</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>    <span class=nb>print</span><span class=p>()</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>    <span class=k>return</span> <span class=n>messages</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=c1># Register the hook with the Mike agent</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=n>agent_mike</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=s2>&quot;process_all_messages_before_reply&quot;</span><span class=p>,</span> <span class=n>prepend_name</span><span class=p>)</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>agent_bob</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>    <span class=n>recipient</span><span class=o>=</span><span class=n>agent_mike</span><span class=p>,</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Let&#39;s tell some jokes!&quot;</span><span class=p>,</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=p>)</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Chat Result messages:</span><span class=se>\n</span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>chat_result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>From the output we can observe: - The messages are updated before Mike replies. - The ChatResult's chat history does not include these temporary changes. - LLMs have an inclination to mimic formats used, so we can see the LLM added ":Mike \nMike said:" to the last message it created (this wasn't created by our hook).</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=go>Bob (to Mike):</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=go>Let&#39;s tell some jokes!</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=go>[Updated messages]:</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=go>[</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=go>  {</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=go>    &quot;content&quot;: &quot;Bob said: Let&#39;s tell some jokes!&quot;,</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=go>  }</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=go>]</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=go>Mike (to Bob):</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=go>Sure, Bob! Here’s one to kick things off:</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=go>Why don’t scientists trust atoms?</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=go>Because they make up everything!</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=go>Got any favorite topics you’d like me to joke about?</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=go>Bob (to Mike):</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=go>Oh, that’s a classic! How about we dive into the world of tech? Here’s one for you:</span>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=go>Why did the computer go to therapy?</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=go>Because it had too many bytes of depression!</span>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a>
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=go>Got any other themes in mind?</span>
<a id=__codelineno-12-40 name=__codelineno-12-40 href=#__codelineno-12-40></a>
<a id=__codelineno-12-41 name=__codelineno-12-41 href=#__codelineno-12-41></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-12-42 name=__codelineno-12-42 href=#__codelineno-12-42></a>
<a id=__codelineno-12-43 name=__codelineno-12-43 href=#__codelineno-12-43></a><span class=go>[Updated messages]:</span>
<a id=__codelineno-12-44 name=__codelineno-12-44 href=#__codelineno-12-44></a><span class=go>[</span>
<a id=__codelineno-12-45 name=__codelineno-12-45 href=#__codelineno-12-45></a><span class=go>  {</span>
<a id=__codelineno-12-46 name=__codelineno-12-46 href=#__codelineno-12-46></a><span class=go>    &quot;content&quot;: &quot;Bob said: Bob said: Let&#39;s tell some jokes!&quot;,</span>
<a id=__codelineno-12-47 name=__codelineno-12-47 href=#__codelineno-12-47></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-12-48 name=__codelineno-12-48 href=#__codelineno-12-48></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-12-49 name=__codelineno-12-49 href=#__codelineno-12-49></a><span class=go>  },</span>
<a id=__codelineno-12-50 name=__codelineno-12-50 href=#__codelineno-12-50></a><span class=go>  {</span>
<a id=__codelineno-12-51 name=__codelineno-12-51 href=#__codelineno-12-51></a><span class=go>    &quot;content&quot;: &quot;Mike said: Sure, Bob! Here\u2019s one to kick things off:\n\nWhy don\u2019t scientists trust atoms?\n\nBecause they make up everything! \n\nGot any favorite topics you\u2019d like me to joke about?&quot;,</span>
<a id=__codelineno-12-52 name=__codelineno-12-52 href=#__codelineno-12-52></a><span class=go>    &quot;role&quot;: &quot;assistant&quot;,</span>
<a id=__codelineno-12-53 name=__codelineno-12-53 href=#__codelineno-12-53></a><span class=go>    &quot;name&quot;: &quot;Mike&quot;</span>
<a id=__codelineno-12-54 name=__codelineno-12-54 href=#__codelineno-12-54></a><span class=go>  },</span>
<a id=__codelineno-12-55 name=__codelineno-12-55 href=#__codelineno-12-55></a><span class=go>  {</span>
<a id=__codelineno-12-56 name=__codelineno-12-56 href=#__codelineno-12-56></a><span class=go>    &quot;content&quot;: &quot;Bob said: Oh, that\u2019s a classic! How about we dive into the world of tech? Here\u2019s one for you:\n\nWhy did the computer go to therapy?\n\nBecause it had too many bytes of depression! \n\nGot any other themes in mind?&quot;,</span>
<a id=__codelineno-12-57 name=__codelineno-12-57 href=#__codelineno-12-57></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-12-58 name=__codelineno-12-58 href=#__codelineno-12-58></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-12-59 name=__codelineno-12-59 href=#__codelineno-12-59></a><span class=go>  }</span>
<a id=__codelineno-12-60 name=__codelineno-12-60 href=#__codelineno-12-60></a><span class=go>]</span>
<a id=__codelineno-12-61 name=__codelineno-12-61 href=#__codelineno-12-61></a>
<a id=__codelineno-12-62 name=__codelineno-12-62 href=#__codelineno-12-62></a>
<a id=__codelineno-12-63 name=__codelineno-12-63 href=#__codelineno-12-63></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-12-64 name=__codelineno-12-64 href=#__codelineno-12-64></a><span class=go>Mike (to Bob):</span>
<a id=__codelineno-12-65 name=__codelineno-12-65 href=#__codelineno-12-65></a>
<a id=__codelineno-12-66 name=__codelineno-12-66 href=#__codelineno-12-66></a><span class=go>:Mike</span>
<a id=__codelineno-12-67 name=__codelineno-12-67 href=#__codelineno-12-67></a><span class=go>Mike said: Great one, Bob! How about we switch gears to animals? Here’s one for you:</span>
<a id=__codelineno-12-68 name=__codelineno-12-68 href=#__codelineno-12-68></a>
<a id=__codelineno-12-69 name=__codelineno-12-69 href=#__codelineno-12-69></a><span class=go>Why don’t seagulls fly over the bay?</span>
<a id=__codelineno-12-70 name=__codelineno-12-70 href=#__codelineno-12-70></a>
<a id=__codelineno-12-71 name=__codelineno-12-71 href=#__codelineno-12-71></a><span class=go>Because then they’d be bagels!</span>
<a id=__codelineno-12-72 name=__codelineno-12-72 href=#__codelineno-12-72></a>
<a id=__codelineno-12-73 name=__codelineno-12-73 href=#__codelineno-12-73></a><span class=go>What do you think? Want to stick with animals, or explore another theme?</span>
<a id=__codelineno-12-74 name=__codelineno-12-74 href=#__codelineno-12-74></a>
<a id=__codelineno-12-75 name=__codelineno-12-75 href=#__codelineno-12-75></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-12-76 name=__codelineno-12-76 href=#__codelineno-12-76></a><span class=go>Chat Result messages:</span>
<a id=__codelineno-12-77 name=__codelineno-12-77 href=#__codelineno-12-77></a><span class=go>[</span>
<a id=__codelineno-12-78 name=__codelineno-12-78 href=#__codelineno-12-78></a><span class=go>  {</span>
<a id=__codelineno-12-79 name=__codelineno-12-79 href=#__codelineno-12-79></a><span class=go>    &quot;content&quot;: &quot;Let&#39;s tell some jokes!&quot;,</span>
<a id=__codelineno-12-80 name=__codelineno-12-80 href=#__codelineno-12-80></a><span class=go>    &quot;role&quot;: &quot;assistant&quot;,</span>
<a id=__codelineno-12-81 name=__codelineno-12-81 href=#__codelineno-12-81></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-12-82 name=__codelineno-12-82 href=#__codelineno-12-82></a><span class=go>  },</span>
<a id=__codelineno-12-83 name=__codelineno-12-83 href=#__codelineno-12-83></a><span class=go>  {</span>
<a id=__codelineno-12-84 name=__codelineno-12-84 href=#__codelineno-12-84></a><span class=go>    &quot;content&quot;: &quot;Sure, Bob! Here\u2019s one to kick things off:\n\nWhy don\u2019t scientists trust atoms?\n\nBecause they make up everything! \n\nGot any favorite topics you\u2019d like me to joke about?&quot;,</span>
<a id=__codelineno-12-85 name=__codelineno-12-85 href=#__codelineno-12-85></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-12-86 name=__codelineno-12-86 href=#__codelineno-12-86></a><span class=go>    &quot;name&quot;: &quot;Mike&quot;</span>
<a id=__codelineno-12-87 name=__codelineno-12-87 href=#__codelineno-12-87></a><span class=go>  },</span>
<a id=__codelineno-12-88 name=__codelineno-12-88 href=#__codelineno-12-88></a><span class=go>  {</span>
<a id=__codelineno-12-89 name=__codelineno-12-89 href=#__codelineno-12-89></a><span class=go>    &quot;content&quot;: &quot;Oh, that\u2019s a classic! How about we dive into the world of tech? Here\u2019s one for you:\n\nWhy did the computer go to therapy?\n\nBecause it had too many bytes of depression! \n\nGot any other themes in mind?&quot;,</span>
<a id=__codelineno-12-90 name=__codelineno-12-90 href=#__codelineno-12-90></a><span class=go>    &quot;role&quot;: &quot;assistant&quot;,</span>
<a id=__codelineno-12-91 name=__codelineno-12-91 href=#__codelineno-12-91></a><span class=go>    &quot;name&quot;: &quot;Bob&quot;</span>
<a id=__codelineno-12-92 name=__codelineno-12-92 href=#__codelineno-12-92></a><span class=go>  },</span>
<a id=__codelineno-12-93 name=__codelineno-12-93 href=#__codelineno-12-93></a><span class=go>  {</span>
<a id=__codelineno-12-94 name=__codelineno-12-94 href=#__codelineno-12-94></a><span class=go>    &quot;content&quot;: &quot;:Mike  \nMike said: Great one, Bob! How about we switch gears to animals? Here\u2019s one for you: \n\nWhy don\u2019t seagulls fly over the bay?\n\nBecause then they\u2019d be bagels! \n\nWhat do you think? Want to stick with animals, or explore another theme?&quot;,</span>
<a id=__codelineno-12-95 name=__codelineno-12-95 href=#__codelineno-12-95></a><span class=go>    &quot;role&quot;: &quot;user&quot;,</span>
<a id=__codelineno-12-96 name=__codelineno-12-96 href=#__codelineno-12-96></a><span class=go>    &quot;name&quot;: &quot;Mike&quot;</span>
<a id=__codelineno-12-97 name=__codelineno-12-97 href=#__codelineno-12-97></a><span class=go>  }</span>
<a id=__codelineno-12-98 name=__codelineno-12-98 href=#__codelineno-12-98></a><span class=go>]</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-03-12T01:15:20+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-12</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../generate-reply/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Generate Reply"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Generate Reply </div> </div> </a> <a href=../../building/creating-a-tool/ class="md-footer__link md-footer__link--next" aria-label="Next: Creating A Tool"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Creating A Tool </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>