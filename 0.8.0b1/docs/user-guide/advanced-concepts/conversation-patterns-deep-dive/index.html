<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A programming framework for agentic AI"><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://ag2ai.github.io/ag2/latest/docs/user-guide/advanced-concepts/conversation-patterns-deep-dive/ rel=canonical><link href=../tools-with-secrets/ rel=prev><link href=../llm-configuration-deep-dive/ rel=next><link rel=icon href=../../../../assets/img/favicon.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.4"><title>Conversation Patterns Deep-dive - AG2</title><link rel=stylesheet href=../../../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../stylesheets/extra.9e326b.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Conversation Patterns Deep-dive"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://ag2ai.github.io/ag2/latest/docs/user-guide/advanced-concepts/conversation-patterns-deep-dive/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Conversation Patterns Deep-dive"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#two-agent-chat-and-chat-result class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> You're viewing the <strong class=primary-text>work in progress</strong> version of the documentation. Please click <a rel=me href=http://docs.ag2.ai><strong>here</strong></a> for the latest. </div> </aside> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Conversation Patterns Deep-dive </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../api-reference/autogen/AfterWork/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../faq/FAQ/ class=md-tabs__link> FAQs </a> </li> <li class=md-tabs__item> <a href=../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> Basic Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Advanced Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Advanced Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../rag/ class=md-nav__link> <span class=md-ellipsis> RAG </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../groupchat/groupchat/ class=md-nav__link> <span class=md-ellipsis> GroupChat </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../swarm/deep-dive/ class=md-nav__link> <span class=md-ellipsis> Swarm </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../interop/langchain/ class=md-nav__link> <span class=md-ellipsis> Interoperability </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../code-execution/ class=md-nav__link> <span class=md-ellipsis> Code Execution </span> </a> </li> <li class=md-nav__item> <a href=../tools-with-secrets/ class=md-nav__link> <span class=md-ellipsis> Tools With Secrets </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Conversation Patterns Deep Dive </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Conversation Patterns Deep Dive </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#two-agent-chat-and-chat-result class=md-nav__link> <span class=md-ellipsis> Two-Agent Chat and Chat Result </span> </a> </li> <li class=md-nav__item> <a href=#sequential-chats class=md-nav__link> <span class=md-ellipsis> Sequential Chats </span> </a> </li> <li class=md-nav__item> <a href=#group-chat class=md-nav__link> <span class=md-ellipsis> Group Chat </span> </a> <nav class=md-nav aria-label="Group Chat"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#send-introductions class=md-nav__link> <span class=md-ellipsis> Send Introductions </span> </a> </li> <li class=md-nav__item> <a href=#group-chat-in-a-sequential-chat class=md-nav__link> <span class=md-ellipsis> Group Chat in a Sequential Chat </span> </a> </li> <li class=md-nav__item> <a href=#constrained-speaker-selection class=md-nav__link> <span class=md-ellipsis> Constrained Speaker Selection </span> </a> </li> <li class=md-nav__item> <a href=#changing-the-select-speaker-role-name class=md-nav__link> <span class=md-ellipsis> Changing the select speaker role name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nested-chats class=md-nav__link> <span class=md-ellipsis> Nested Chats </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../llm-configuration-deep-dive/ class=md-nav__link> <span class=md-ellipsis> LLM Configuration Deep Dive </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../models/amazon-bedrock/ class=md-nav__link> <span class=md-ellipsis> Model Providers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference-agents/ class=md-nav__link> <span class=md-ellipsis> Reference Agents </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api-reference/autogen/AfterWork/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../faq/FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#two-agent-chat-and-chat-result class=md-nav__link> <span class=md-ellipsis> Two-Agent Chat and Chat Result </span> </a> </li> <li class=md-nav__item> <a href=#sequential-chats class=md-nav__link> <span class=md-ellipsis> Sequential Chats </span> </a> </li> <li class=md-nav__item> <a href=#group-chat class=md-nav__link> <span class=md-ellipsis> Group Chat </span> </a> <nav class=md-nav aria-label="Group Chat"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#send-introductions class=md-nav__link> <span class=md-ellipsis> Send Introductions </span> </a> </li> <li class=md-nav__item> <a href=#group-chat-in-a-sequential-chat class=md-nav__link> <span class=md-ellipsis> Group Chat in a Sequential Chat </span> </a> </li> <li class=md-nav__item> <a href=#constrained-speaker-selection class=md-nav__link> <span class=md-ellipsis> Constrained Speaker Selection </span> </a> </li> <li class=md-nav__item> <a href=#changing-the-select-speaker-role-name class=md-nav__link> <span class=md-ellipsis> Changing the select speaker role name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nested-chats class=md-nav__link> <span class=md-ellipsis> Nested Chats </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/website/mkdocs/docs/docs/user-guide/advanced-concepts/conversation-patterns-deep-dive.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1>Conversation Patterns Deep Dive</h1> <p>In this conversation patterns deep-dive we run through conversation patterns (with the exception of Swarm, <a href=/docs/user-guide/advanced-concepts/swarm-deep-dive>see more here</a>).</p> <ol> <li><strong>Two-agent chat</strong>: the simplest form of conversation pattern where two agents chat with each other.</li> <li><strong>Sequential chat</strong>: a sequence of chats between two agents, chained together by a carryover mechanism, which brings the summary of the previous chat to the context of the next chat.</li> <li><strong>Group Chat</strong>: a single chat involving more than two agents. An important question in group chat is: What agent should be next to speak? To support different scenarios, we provide different ways to organize agents in a group chat:<ul> <li>We support several strategies to select the next agent: <code>round_robin</code>, <code>random</code>, <code>manual</code> (human selection), and <code>auto</code> (Default, using an LLM to decide).</li> <li>We provide a way to constrain the selection of the next speaker (See examples below).</li> <li>We allow you to pass in a function to customize the selection of the next speaker. With this feature, you can build a <strong>StateFlow</strong> model which allows a deterministic workflow among your agents.</li> </ul> </li> <li><strong>Nested Chat</strong>: package a workflow into a single agent for reuse in a larger workflow.</li> </ol> <h2 id=two-agent-chat-and-chat-result>Two-Agent Chat and Chat Result<a class=headerlink href=#two-agent-chat-and-chat-result title="Permanent link">#</a></h2> <p>Two-agent chat is the simplest form of conversation pattern. We start a two-agent chat using the <code>initiate_chat</code> method of every <code>ConversableAgent</code> agent.</p> <p>The following figure illustrates how two-agent chat works.</p> <p><img alt="Two-agent chat" src=../assets/two-agent-chat.png></p> <p>A two-agent chats takes two inputs: a message, which is a string provided by the caller; a context, which specifies various parameters of the chat.</p> <p>The sender agent uses its chat initializer method (i.e., <code>generate_init_message</code> method of <code>ConversableAgent</code>) to generate an initial message from the inputs, and sends it to the recipient agent to start the chat.</p> <p>The sender agent is the agent whose <code>initiate_chat</code> method is called, and the recipient agent is the other agent.</p> <p>Once the chat terminates, the history of the chat is processed by a chat summarizer. The summarizer summarizes the chat history and calculates the token usage of the chat. You can configure the type of summary using the <code>summary_method</code> parameter of the <code>initiate_chat</code> method. By default, it is the last message of the chat (i.e., <code>summary_method='last_msg'</code>).</p> <p>The example below is a two-agent chat between a student agent and a teacher agent. Its summarizer uses an LLM-based summary.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=n>student_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Student_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are a student willing to learn.&quot;</span><span class=p>,</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=p>)</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=n>teacher_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Teacher_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are a math teacher.&quot;</span><span class=p>,</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=p>)</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>student_agent</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    <span class=n>teacher_agent</span><span class=p>,</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;What is triangle inequality?&quot;</span><span class=p>,</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>    <span class=n>summary_method</span><span class=o>=</span><span class=s2>&quot;reflection_with_llm&quot;</span><span class=p>,</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=p>)</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=nb>print</span><span class=p>(</span><span class=n>chat_result</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
</code></pre></div> <p>In the above example, the summary method is set to <code>reflection_with_llm</code> which takes a list of messages from the conversation and summarize them using a call to an LLM.</p> <p>The summary method first tries to use the recipient's LLM, if it is not available then it uses the sender's LLM. In this case the recipient is "Teacher_Agent" and the sender is "Student_Agent".</p> <p>The input prompt for the LLM is the following default prompt:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nb>print</span><span class=p>(</span><span class=n>ConversableAgent</span><span class=o>.</span><span class=n>DEFAULT_SUMMARY_PROMPT</span><span class=p>)</span>
</code></pre></div> <p>You can also use a custom prompt by setting the <code>summary_prompt</code> argument of <code>initiate_chat</code>.</p> <p>There are some other useful information in the <code>ChatResult</code> object, including the conversation history, human input, and token cost.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Get the chat history.</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>import</span><span class=w> </span><span class=nn>pprint</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>pprint</span><span class=o>.</span><span class=n>pprint</span><span class=p>(</span><span class=n>chat_result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>)</span>
</code></pre></div> <h2 id=sequential-chats>Sequential Chats<a class=headerlink href=#sequential-chats title="Permanent link">#</a></h2> <p>The name of this pattern is self-explanatory -- it is a sequence of chats between two agents, chained together by a mechanism called <em>carryover</em>, which brings the summary of the previous chat to the context of the next chat.</p> <p>This pattern is useful for complex task that can be broken down into interdependent sub-tasks.</p> <p>The figure below illustrate how this pattern works.</p> <p><img alt=initiate_chats src=../assets/sequential-two-agent-chat.png></p> <p>In this pattern, the a pair of agents first start a two-agent chat, then the summary of the conversation becomes a <em>carryover</em> for the next two-agent chat. The next chat passes the carryover to the <code>carryover</code> parameter of the context to generate its initial message.</p> <p>Carryover accumulates as the conversation moves forward, so each subsequent chat starts with all the carryovers from previous chats.</p> <p>The figure above shows distinct recipient agents for all the chats, however, the recipient agents in the sequence are allowed to repeat.</p> <p>To illustrate this pattern, let's consider a simple example of arithmetic operator agents. One agent (called the "Number_Agent") is responsible for coming up with a number, and other agents are responsible for performing a specific arithmetic operation on the number, e.g., add 1, multiply by 2, etc..</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># The Number Agent always returns the same numbers.</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>number_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Number_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You return me the numbers I give you, one number each line.&quot;</span><span class=p>,</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=p>)</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=c1># The Adder Agent adds 1 to each number it receives.</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=n>adder_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Adder_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You add 1 to each number I give you and return me the new numbers, one number each line.&quot;</span><span class=p>,</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=p>)</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=c1># The Multiplier Agent multiplies each number it receives by 2.</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=n>multiplier_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Multiplier_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You multiply each number I give you by 2 and return me the new numbers, one number each line.&quot;</span><span class=p>,</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=p>)</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=c1># The Subtracter Agent subtracts 1 from each number it receives.</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=n>subtracter_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Subtracter_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You subtract 1 from each number I give you and return me the new numbers, one number each line.&quot;</span><span class=p>,</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=p>)</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=c1># The Divider Agent divides each number it receives by 2.</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=n>divider_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Divider_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You divide each number I give you by 2 and return me the new numbers, one number each line.&quot;</span><span class=p>,</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=p>)</span>
</code></pre></div> <p>The Number Agent chats with the first operator agent, then the second operator agent, and so on.</p> <p>After each chat, the last message in the conversation (i.e., the result of the arithmetic operation from the operator agent) is used as the summary of the chat.</p> <p>This is specified by the <code>summary_method</code> parameter.</p> <p>In the end we will have the result of the arithmetic operations.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Start a sequence of two-agent chats.</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># Each element in the list is a dictionary that specifies the arguments</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1># for the initiate_chat method.</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=n>chat_results</span> <span class=o>=</span> <span class=n>number_agent</span><span class=o>.</span><span class=n>initiate_chats</span><span class=p>(</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=p>[</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=p>{</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>adder_agent</span><span class=p>,</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;14&quot;</span><span class=p>,</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>            <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>            <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;last_msg&quot;</span><span class=p>,</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=p>},</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=p>{</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>multiplier_agent</span><span class=p>,</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;These are my numbers&quot;</span><span class=p>,</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>            <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>            <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;last_msg&quot;</span><span class=p>,</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>        <span class=p>},</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>        <span class=p>{</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>subtracter_agent</span><span class=p>,</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;These are my numbers&quot;</span><span class=p>,</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>            <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>            <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;last_msg&quot;</span><span class=p>,</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>        <span class=p>},</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>        <span class=p>{</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>divider_agent</span><span class=p>,</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;These are my numbers&quot;</span><span class=p>,</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>            <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>            <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;last_msg&quot;</span><span class=p>,</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>        <span class=p>},</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=p>]</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=p>)</span>
</code></pre></div> <p>First thing to note is that the <code>initiate_chats</code> method takes a list of dictionaries, each dictionary contains the arguments for the <code>initiate_chat</code> method.</p> <p>Second, each chat in the sequence has a maximum round of 2, as specified with the setting <code>max_turns=2</code>, which means each arithmetic operation is performed twice. So you can see in the first chat the number 14 becomes 15 and then 16, in the second chat the number 16 becomes 32 and then 64, and so on.</p> <p>Third, the carryover accumulates as the chats go on. In the second chat, the carryover is the summary of the first chat "16". In the third chat, the carryover is the summary of the first and second chat, which is the list "16" and "64", and both numbers are operated upon. In the forth and last chat, the carryover is the summary of all previous chats, which is the list "16", "64", "14" and "62", and all of these numbers are operated upon.</p> <p>The final note is that the <code>initiate_chats</code> method returns a list of <code>ChatResult</code> objects, one for each chat in the sequence.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;First Chat Summary: &quot;</span><span class=p>,</span> <span class=n>chat_results</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Second Chat Summary: &quot;</span><span class=p>,</span> <span class=n>chat_results</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Third Chat Summary: &quot;</span><span class=p>,</span> <span class=n>chat_results</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Fourth Chat Summary: &quot;</span><span class=p>,</span> <span class=n>chat_results</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
</code></pre></div> <p>Besides calling <code>initiate_chats</code> from the same sender agent, you can also call a high-level function <code>autogen.agentchat.initiate_chats</code> to start a sequence of two-agent chats with different sender agents.</p> <p>This function allows you to specify the sender agent for each chat in the sequence.</p> <h2 id=group-chat>Group Chat<a class=headerlink href=#group-chat title="Permanent link">#</a></h2> <p>So far we have only seen conversation patterns that involve two agents or a sequence of two-agent chats. AutoGen provides a more general conversation pattern called group chat, which involves more than two agents.</p> <p>The core idea of group chat is that all agents contribute to a single conversation thread and share the same context.</p> <p>This is useful for tasks that require collaboration among multiple agents.</p> <p>The figure below illustrates how group chat works.</p> <p><img alt=group_chat src=../assets/group-chat.png></p> <p>A group chat is orchestrated by a special agent type <code>GroupChatManager</code>. In the first step of the group chat, the Group Chat Manager selects an agent to speak. Then, the selected agent speaks and the message is sent back to the Group Chat Manager, who <strong>broadcasts</strong> the message to all other agents in the group.</p> <p>This process repeats until the conversation stops.</p> <p>The Group Chat Manager can use several strategies to select the next agent.</p> <p>Currently, the following strategies are supported:</p> <ol> <li><code>round_robin</code>: The Group Chat Manager selects agents in a round-robin fashion based on the order of the agents provided.</li> <li><code>random</code>: The Group Chat Manager selects agents randomly.</li> <li><code>manual</code>: The Group Chat Manager selects agents by asking for human input.</li> <li><code>auto</code>: The default strategy, which selects agents using the Group Chat Manager's LLM.</li> </ol> <p>To illustrate this pattern, let's consider a simple example of a group chat among the same arithmetic operator agents as in the previous example, with the objective of turning a number into a specific target number using a sequence of arithmetic operations powered by the agents.</p> <p>In this example, we use the <code>auto</code> strategy to select the next agent.</p> <p>To help the Group Chat Manager select the next agent, we also set the <code>description</code> of the agents. Without the <code>description</code>, the Group Chat Manager will use the agents' <code>system_message</code>, which may be not be the best choice.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># The `description` attribute is a string that describes the agent.</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=c1># It can also be set in `ConversableAgent` constructor.</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>adder_agent</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Add 1 to each input number.&quot;</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>multiplier_agent</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Multiply each input number by 2.&quot;</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=n>subtracter_agent</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Subtract 1 from each input number.&quot;</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=n>divider_agent</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Divide each input number by 2.&quot;</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>number_agent</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Return the numbers given.&quot;</span>
</code></pre></div> <p>We first create a <code>GroupChat</code> object and provide the list of agents. If we were to use the <code>round_robin</code> strategy, this list would specify the order of the agents to be selected.</p> <p>We also initialize the group chat with an empty message list and a maximum round of 6, which means there will be at most 6 iteratiosn of selecting speaker, agent speaks and broadcasting message.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>GroupChat</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>group_chat</span> <span class=o>=</span> <span class=n>GroupChat</span><span class=p>(</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>adder_agent</span><span class=p>,</span> <span class=n>multiplier_agent</span><span class=p>,</span> <span class=n>subtracter_agent</span><span class=p>,</span> <span class=n>divider_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=n>messages</span><span class=o>=</span><span class=p>[],</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=n>max_round</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=p>)</span>
</code></pre></div> <p>Now we create a <code>GroupChatManager</code> object and provide the <code>GroupChat</code> object as input. We also need to specify the <code>llm_config</code> of the Group Chat Manager so it can use the LLM to select the next agent (the <code>auto</code> strategy).</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>GroupChatManager</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>group_chat_manager</span> <span class=o>=</span> <span class=n>GroupChatManager</span><span class=p>(</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=n>groupchat</span><span class=o>=</span><span class=n>group_chat</span><span class=p>,</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=p>)</span>
</code></pre></div> <p>Finally, we have the Number Agent from before to start a two-agent chat with the Group Chat Manager, which runs the group chat internally and terminates the two-agent chat when the internal group chat is done. Because the Number Agent is selected to speak by us, it counts as the first round of the group chat.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>number_agent</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=n>group_chat_manager</span><span class=p>,</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;My number is 3, I want to turn it into 13.&quot;</span><span class=p>,</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>summary_method</span><span class=o>=</span><span class=s2>&quot;reflection_with_llm&quot;</span><span class=p>,</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=p>)</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=nb>print</span><span class=p>(</span><span class=n>chat_result</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
</code></pre></div> <p>You will see that the Number Agent is selected to speak first, then the Group Chat Manager selects the Multiplier Agent to speak, then the Adder Agent, and so on. The number is operated upon by each agent in the group chat, and the final result is 13.</p> <h3 id=send-introductions>Send Introductions<a class=headerlink href=#send-introductions title="Permanent link">#</a></h3> <p>In the previous example, we set the <code>description</code> of the agents to help the Group Chat Manager select the next agent. This only helps the Group Chat Manager, however, does not help the participating agents to know about each other.</p> <p>Sometimes it is useful have each agent introduce themselves to other agents in the group chat. This can be done by setting the <code>send_introductions=True</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>group_chat_with_introductions</span> <span class=o>=</span> <span class=n>GroupChat</span><span class=p>(</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>adder_agent</span><span class=p>,</span> <span class=n>multiplier_agent</span><span class=p>,</span> <span class=n>subtracter_agent</span><span class=p>,</span> <span class=n>divider_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>messages</span><span class=o>=</span><span class=p>[],</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>max_round</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>send_introductions</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=p>)</span>
</code></pre></div> <p>Under the hood, the Group Chat Manager sends a message containing the agents' names and descriptions to all agents in the group chat before the group chat starts.</p> <h3 id=group-chat-in-a-sequential-chat>Group Chat in a Sequential Chat<a class=headerlink href=#group-chat-in-a-sequential-chat title="Permanent link">#</a></h3> <p>Group chat can also be used as a part of a sequential chat.</p> <p>In this case, the Group Chat Manager is treated as a regular agent in the sequence of two-agent chats.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Let&#39;s use the group chat with introduction messages created above.</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>group_chat_manager_with_intros</span> <span class=o>=</span> <span class=n>GroupChatManager</span><span class=p>(</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=n>groupchat</span><span class=o>=</span><span class=n>group_chat_with_introductions</span><span class=p>,</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=p>)</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=c1># Start a sequence of two-agent chats between the number agent and</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=c1># the group chat manager.</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>number_agent</span><span class=o>.</span><span class=n>initiate_chats</span><span class=p>(</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    <span class=p>[</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>        <span class=p>{</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>group_chat_manager_with_intros</span><span class=p>,</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;My number is 3, I want to turn it into 13.&quot;</span><span class=p>,</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>        <span class=p>},</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>        <span class=p>{</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>            <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>group_chat_manager_with_intros</span><span class=p>,</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Turn this number to 32.&quot;</span><span class=p>,</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>        <span class=p>},</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>    <span class=p>]</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=p>)</span>
</code></pre></div> <p>In the above example, the Group Chat Manager runs the group chat two times. In the first time the number 3 becomes 13, and the last message of this group chat is being used as the carryover for the next group chat, which starts from 13.</p> <p>You will also see from the warning message that the Group Chat Manager's history is being cleared after the first group chat, which is the default.</p> <p>To keep the history of the Group Chat Manager, you can set the <code>clear_history=False</code> for the first chat.</p> <h3 id=constrained-speaker-selection>Constrained Speaker Selection<a class=headerlink href=#constrained-speaker-selection title="Permanent link">#</a></h3> <p>Group chat is a powerful conversation pattern, but it can be hard to control if the number of participating agents is large.</p> <p>AG2 provides a way to constrain the selection of the next speaker by using the <code>allowed_or_disallowed_speaker_transitions</code> argument of the <code>GroupChat</code> class.</p> <p>The <code>allowed_or_disallowed_speaker_transitions</code> argument is a dictionary that maps a given agent to a list of agents that can (or cannot) be selected to speak next. The <code>speaker_transitions_type</code> argument specifies whether the transitions are allowed or disallowed.</p> <p>Here is an example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>allowed_transitions</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=n>number_agent</span><span class=p>:</span> <span class=p>[</span><span class=n>adder_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>adder_agent</span><span class=p>:</span> <span class=p>[</span><span class=n>multiplier_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>subtracter_agent</span><span class=p>:</span> <span class=p>[</span><span class=n>divider_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    <span class=n>multiplier_agent</span><span class=p>:</span> <span class=p>[</span><span class=n>subtracter_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>divider_agent</span><span class=p>:</span> <span class=p>[</span><span class=n>adder_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=p>}</span>
</code></pre></div> <p>In this example, the allowed transitions are specified for each agent.</p> <p>The Number Agent can be followed by the Adder Agent and the Number Agent, the Adder Agent can be followed by the Multiplier Agent and the Number Agent, and so on.</p> <p>Let's put this into the group chat and see how it works.</p> <p>The <code>speaker_transitions_type</code> is set to <code>allowed</code> so the transitions are positive constraints.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>constrained_graph_chat</span> <span class=o>=</span> <span class=n>GroupChat</span><span class=p>(</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>adder_agent</span><span class=p>,</span> <span class=n>multiplier_agent</span><span class=p>,</span> <span class=n>subtracter_agent</span><span class=p>,</span> <span class=n>divider_agent</span><span class=p>,</span> <span class=n>number_agent</span><span class=p>],</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>allowed_or_disallowed_speaker_transitions</span><span class=o>=</span><span class=n>allowed_transitions</span><span class=p>,</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=n>speaker_transitions_type</span><span class=o>=</span><span class=s2>&quot;allowed&quot;</span><span class=p>,</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>    <span class=n>messages</span><span class=o>=</span><span class=p>[],</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=n>max_round</span><span class=o>=</span><span class=mi>12</span><span class=p>,</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>    <span class=n>send_introductions</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=p>)</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=n>constrained_group_chat_manager</span> <span class=o>=</span> <span class=n>GroupChatManager</span><span class=p>(</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>    <span class=n>groupchat</span><span class=o>=</span><span class=n>constrained_graph_chat</span><span class=p>,</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=p>)</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=n>chat_result</span> <span class=o>=</span> <span class=n>number_agent</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>    <span class=n>constrained_group_chat_manager</span><span class=p>,</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;My number is 3, I want to turn it into 10. Once I get to 10, keep it there.&quot;</span><span class=p>,</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>    <span class=n>summary_method</span><span class=o>=</span><span class=s2>&quot;reflection_with_llm&quot;</span><span class=p>,</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=p>)</span>
</code></pre></div> <p>When this is run, the agents are selected following the constraints we have specified.</p> <h3 id=changing-the-select-speaker-role-name>Changing the select speaker role name<a class=headerlink href=#changing-the-select-speaker-role-name title="Permanent link">#</a></h3> <p>As part of the Group chat process, when the select_speaker_method is set to 'auto' (the default value), a select speaker message is sent to the LLM to determine the next speaker.</p> <p>Each message in the chat sequence has a <code>role</code> attribute that is typically <code>user</code>, <code>assistant</code>, or <code>system</code>. The select speaker message is the last in the chat sequence when used and, by default, has a role of <code>system</code>.</p> <p>When using some models, such as Mistral through Mistral.AI's API, the role on the last message in the chat sequence has to be <code>user</code>.</p> <p>To change the default behaviour, Autogen provides a way to set the value of the select speaker message's role to any string value by setting the <code>role_for_select_speaker_messages</code> parameter in the GroupChat's constructor. The default value is <code>system</code> and by setting it to <code>user</code> you can accommodate the last message role requirement of Mistral.AI's API.</p> <h2 id=nested-chats>Nested Chats<a class=headerlink href=#nested-chats title="Permanent link">#</a></h2> <p>The previous conversations patterns (two-agent chat, sequential chat, and group chat) are useful for building complex workflows, however, they do not expose a single conversational interface, which is often needed for scenarios like question-answering bots and personal assistants.</p> <p>In some other cases, it is also useful to package a workflow into a single agent for reuse in a larger workflow.</p> <p>AG2 provides a way to achieve this by using nested chats.</p> <p>Nested chats is powered by the nested chats handler, which is a pluggable component of <code>ConversableAgent</code>. The figure below illustrates how the nested chats handler triggers a sequence of nested chats when a message is received.</p> <p><img alt=nested_chat src=../assets/nested-chats.png></p> <p>When a message comes in and passes the <a href=./human-in-the-loop>human-in-the-loop component</a>, the nested chats handler checks if the message should trigger a nested chat based on conditions specified by the user.</p> <p>If the conditions are met, the nested chats handler starts a sequence of nested chats specified using the sequential chats pattern.</p> <p>In each of the nested chats, the sender agent is always the same agent that triggered the nested chats.</p> <p>In the end, the nested chat handler uses the results of the nested chats to produce a response to the original message.</p> <p>By default, the nested chat handler uses the summary of the last chat as the response.</p> <p>Here is an example of using nested chats to build an arithmetic agent that packages arithmetic operations, code-based validation, and poetry into a single agent. This arithmetic agent takes a number transformation request like "turn number 3 into 13" and returns a poem that describes a transformation attempt.</p> <p>First we define the agents. We reuse the <code>group_chat_manager_with_intros</code> from previous example to orchestrate the arithmetic operations.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kn>import</span><span class=w> </span><span class=nn>tempfile</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=n>temp_dir</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>gettempdir</span><span class=p>()</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=n>arithmetic_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Arithmetic_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>llm_config</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;ALWAYS&quot;</span><span class=p>,</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=c1># This agent will always require human input to make sure the code is</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>    <span class=c1># safe to execute.</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>    <span class=n>code_execution_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;use_docker&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;work_dir&quot;</span><span class=p>:</span> <span class=n>temp_dir</span><span class=p>},</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=p>)</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=n>code_writer_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Code_Writer_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are a code writer. You write Python script in Markdown code blocks.&quot;</span><span class=p>,</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=p>)</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=n>poetry_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Poetry_Agent&quot;</span><span class=p>,</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are an AI poet.&quot;</span><span class=p>,</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;api_type&quot;</span><span class=p>:</span> <span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]}]},</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=p>)</span>
</code></pre></div> <p>Now we define the nested chats using the sequential chat pattern. All the senders are always <code>artihmetic_agent</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>nested_chats</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=p>{</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>        <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>group_chat_manager_with_intros</span><span class=p>,</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>        <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;reflection_with_llm&quot;</span><span class=p>,</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>        <span class=s2>&quot;summary_prompt&quot;</span><span class=p>:</span> <span class=s2>&quot;Summarize the sequence of operations used to turn the source number into target number.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=p>},</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=p>{</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>        <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>code_writer_agent</span><span class=p>,</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>        <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Write a Python script to verify the arithmetic operations is correct.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>        <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;reflection_with_llm&quot;</span><span class=p>,</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>    <span class=p>},</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>    <span class=p>{</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>        <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>poetry_agent</span><span class=p>,</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>        <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Write a poem about it.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>        <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>        <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=s2>&quot;last_msg&quot;</span><span class=p>,</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>    <span class=p>},</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=p>]</span>
</code></pre></div> <p>Now we register the nested chats handler to the <code>arithmetic_agent</code> and set the conditions for triggering the nested chats.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>arithmetic_agent</span><span class=o>.</span><span class=n>register_nested_chats</span><span class=p>(</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=n>nested_chats</span><span class=p>,</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=c1># The trigger function is used to determine if the agent should start the nested chat</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=c1># given the sender agent.</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=c1># In this case, the arithmetic agent will not start the nested chats if the sender is</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=c1># from the nested chats&#39; recipient to avoid recursive calls.</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>    <span class=n>trigger</span><span class=o>=</span><span class=k>lambda</span> <span class=n>sender</span><span class=p>:</span> <span class=n>sender</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=n>group_chat_manager_with_intros</span><span class=p>,</span> <span class=n>code_writer_agent</span><span class=p>,</span> <span class=n>poetry_agent</span><span class=p>],</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=p>)</span>
</code></pre></div> <p>Finally, we call <code>generate_reply</code> to get a response from the <code>arithmetic_agent</code> -- this will trigger a sequence of nested chats and return the summary of the last nested chat as the response.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Instead of using `initiate_chat` method to start another conversation,</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=c1># we can use the `generate_reply` method to get single reply to a message directly.</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=n>reply</span> <span class=o>=</span> <span class=n>arithmetic_agent</span><span class=o>.</span><span class=n>generate_reply</span><span class=p>(</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>messages</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;I have a number 3 and I want to turn it into 7.&quot;</span><span class=p>}]</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=p>)</span>
</code></pre></div> <p>A poem will be returned as the response, which describes the transformation attempt from 3 to 7.</p> <p>The implementation of the nested chats handler makes use of the <a href=/docs/api-reference/autogen/ConversableAgent#register-reply><code>register_reply</code></a> method, which allows you to make extensive customization to <code>ConversableAgent</code>. The GroupChatManager uses the same mechanism to implement the group chat.</p> <p>Nested chat is a powerful conversation pattern that allows you to package complex workflows into a single agent.</p> <p>You can hide tool usage within a single agent by having the tool-caller agent starts a nested chat with a tool-executor agent and then use the result of the nested chat to generate a response.</p> <p>See the <a href=/docs/use-cases/notebooks/notebooks/agentchat_nested_chats_chess>nested chats for tool use notebook</a> for an example.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-03-02T23:23:17+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-02</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../tools-with-secrets/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Tools With Secrets"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Tools With Secrets </div> </div> </a> <a href=../llm-configuration-deep-dive/ class="md-footer__link md-footer__link--next" aria-label="Next: LLM Configuration Deep Dive"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> LLM Configuration Deep Dive </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.f1b6f286.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>